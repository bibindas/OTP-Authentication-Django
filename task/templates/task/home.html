<!DOCTYPE html>
<html>
<head>
 {% load static %}
<link rel='stylesheet' href="{% static "css/selectize.css" %}">
</head>
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>

<h1>Home</h1>
<body>
 
  <input type="search" id="search" placeholder="Search" name="search">
  <button type="button" onclick="search()">Search</button><br>

  <a href="#"  id="logout" onClick="logout()">Logout </a>
<script src="{% static 'js/selectize.js' %}"></script>

<script type="text/javascript">
  $(document).ready(function () {
   if ((localStorage.getItem("token") == "") || (localStorage.getItem("token") == undefined))  {
      window.location = "http://127.0.0.1:8000";

   }
});

  function logout(){
    
     $.ajax({
          type: "POST",
          url: "/api/logout/",
          data: {},
          headers: { Authorization: localStorage.getItem("token") },

          success: function(res){
            console.log(res)
              if (res.status=="OK"){
                  console.log(res)
                localStorage.setItem("token", "");

                  window.location = "http://127.0.0.1:8000";
 
              }
              else{
                alert("HHHHHHHHHHHHH")
              }
          },
          error:function(res){
              alert("errorRRRRRRRR");
          }
        });
  };

$('#search').selectize({
load: function (query, callback) {
if (!query.length) return callback();
$.ajax({
url: '/api/search/',
data:{search:query},

type: 'POST',
headers: { Authorization: localStorage.getItem("token") },


error: function () {
callback();
},
success: function (res) {
console.log(res.country_list)
callback(res.country_list.slice(0, 10));
}
});
}
});
</script>


</body>
</html>